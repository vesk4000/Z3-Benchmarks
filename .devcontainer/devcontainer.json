// .devcontainer/devcontainer.json
{
	"name": "BenchExec Development",
	"build": {
		"dockerfile": "../Dockerfile",
		"context": ".."
	},
	"workspaceFolder": "/workspace",
	"remoteUser": "benchuser",
	"runArgs": [
		"--privileged",
		"--cap-drop=all",
		"--security-opt",
		"seccomp=unconfined",
		"--cgroupns=host",
		"--device",
		"/dev/fuse",
		"-v",
		"/sys/fs/cgroup:/sys/fs/cgroup:rw",
		"--mount",
		"type=volume,source=z3-bench-persistent-setup,target=/opt/persistent-setup",
		"--mount",
		"type=volume,source=z3-bench-apt-cache,target=/var/cache/apt",
		"--mount",
		"type=volume,source=z3-bench-pip-cache,target=/home/benchuser/.cache/pip"
	],
	"containerEnv": {
		"BENCHEXEC_CONTAINER": "1"
	},
	"customizations": {
		"vscode": {
			"extensions": [
				"ms-python.python",
				"ms-vscode.cpptools",
				"ms-azuretools.vscode-docker"
			],
			"settings": {
				"python.defaultInterpreterPath": "/usr/bin/python3",
				"terminal.integrated.shell.linux": "/bin/bash"
			}
		}
	},
	"mounts": [
		"source=${localWorkspaceFolder},target=/workspace,type=bind,consistency=cached"
	],
	"postCreateCommand": "echo 'Hello There'",
	"postStartCommand": "CGROUP_PATH=\"$(grep -m1 '/docker/' /proc/self/cgroup | cut -d: -f3)\" && for s in cpuacct cpuset freezer memory; do sudo chmod o+wt \"/sys/fs/cgroup/$s$CGROUP_PATH\"; done && echo 'Container ready! Available Z3 versions: z3-latest, z3-4.12.0, z3-4.11.2' && echo 'BenchExec ready. Run: benchexec --help'"
}